---
title: '`dplyr` Lab : answers'
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
    css: ../../../styles.css
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=TRUE, fig.align = 'center')
library(tidyverse)
```

# dplyr lab

**Duration: 1 hour**

<br>

You now have an opportunity to practice the skills you've learnt today in a mini lab task. 

For this you will be using data which contains income generated by US states from year 2002 to 2015. Note : This data do not contain actual income figures of the states. This can be found in `state_income_data.csv`

This dataset contains 51 observations (rows) and 16 variables (columns). 

## Task

Answer the following questions: 

1. Load in the data.  
2. Select the variables `Index`, and the columns from `State` to `Y2008`.  
3. Rename the `Index` column to `first_letter`. *Hint: look up the `rename()` function*    
4. Group the data by what `first_letter` it has.    
5. Filter rows and retain only states which start with an C. 

<br>

<details>
<summary>**Solutions: part 1**</summary>


```{r}

# load in the data 
state_income <- read_csv("data/state_income_data.csv")

# Select the variables "Index", columns from "State" to "Y2008".
state_income2 <- select(state_income, Index, State:Y2008)

# rename the Index column to `first_letter`
state_renamed <- rename(state_income2, first_letter=Index)

# group the data by what `first_letter` it has
state_grouped <- group_by(state_renamed, first_letter)

# filter rows and retain only states which start with an C. 
state_c = filter(state_renamed, first_letter == "C")
```

</details>
<br>

From now on, work with your tibble from above, which only has data for states that start with the letter C. <br>

6. Calculate the change in income for each state between 2005 and 2006. Save it in a new column called `income_change`.   
7. Find which state's income is greater than 1.9 million in year 2007.  
8. Arrange the data so that the state with the highest income in year 2007 is shown first.  
9. Calculate the mean and median for year 2008 for all three states.  
10. Write a pipe which groups the states by their first letter, chooses the year 2008, ranks the income from highest to lowest, and then finally filters all those states which have a ranking of 1.  (i.e. get the top income states for each letter, *hint: look up how to use the `min_rank` function) 

<br>

<details>
<summary>**Solutions: part 2**</summary>
```{r}

# calculate the change in income for states beginning with C between 2005 and 2006. Save it in a new column called `income_change`
state_income_change = mutate(state_c, income_change=Y2006-Y2005)

# find which states' income is greater than 1.9 million in year 2007
state_million = filter(state_c, Y2007 >=1900000)

# arrange the data so that the state with the highest income in year 2007 is shown first
state_arranged <- state_c %>% 
    select(State, Y2007) %>%
    arrange(desc(Y2007))
       
# calculate the mean and median for the year 2008 across the three states
state_stats <- summarise(state_c, Y2008_mean = mean(Y2008), Y2008_median=median(Y2008))

# write a pipe which groups the states by their first letter, chooses the year 2008, ranks the income from highest to lowest, and then finally filters all those states which have a ranking of 1. 
highest_income <- state_renamed %>% 
  select(first_letter, State, Y2008) %>%
  group_by(first_letter) %>% 
  arrange(desc(Y2008)) %>%
  mutate( ranking =(min_rank(Y2008))) %>%
  filter(ranking ==1)

```
</details>
