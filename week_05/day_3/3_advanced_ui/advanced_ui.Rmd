---
title: "Advanced UI"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
    css: ../../../../styles.css
  pdf_document: default
runtime: shiny
---

<div class="blame">
author: "Mhairi McNeill"<br>
date: "24/06/2019"
</div>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = 'center')
```

# Learning Objectives<br>

* Know how to include HTML in a Shiny app
* Be able to use themes and UI layouts in Shiny

**Duration - 1 hour 30 minutes**<br>

# HTML in Shiny Apps

## What is HTML?

You should be familiar with both HTML at this point. Here's a quick reminder. To format a piece of text you have to wrap it in a pair of commands specified with angle brackets `<` and `>`. The commands `<i>` and `</i>` indicate that text should be in italics. So

```
<i>Italics text</i>
```

becomes

<pre>
<i>Italics text</i> 
</pre>

Here's a list of some HTML tags for revision.

| HTML                                                      | Description                                                                     |
|-----------------------------------------------------------|---------------------------------------------------------------------------------|
| `<a href="https://codeclan.com/">code clan's website</a>` | Used for making web links                                                       |
| `<b> </b>`                                                | Bold text                                                                       |
| `<br>`                                                    | A line break                                                                    |
| `<div> </div>`                                            | Used to specify sections of the page. Generally used with style sheets.         |
| `<h1> </h1>`, `<h2> </h2>`, â€¦ `<h6> </h6>`                | Use to specify headers, `<h1>` is the largest header and `<h6>` is the smallest |
| `<hr>`                                                    | A horizontal line.                                                              |
| `<i> </i>`                                                | Italics text                                                                    |
| `<img src="my_picture.jpg" alt="Hover text for picture">` | Place an image                                                                  |
| `<li> </li>`                                              | Create items in a list, used within `<ol>` or `<ul>`                            |
| `<ol> </ol>`                                              | Create an ordered list, items will be numbered                                  |
| `<p> </p>`                                                | A paragraph                                                                     |
| `<pre> </pre>`                                            | Preformatted text. Useful for including code.                                   |
| `<table> </table>`                                        | Create a table                                                                  |
| `<td> </td>`                                              | A cell with data, within a table                                                |
| `<th> </th>`                                              | A header cell, within a table                                                   |
| `<tr> </tr>`                                              | A row, within a table                                                           |
| `<ul> </ul>`                                              | An unordered list, items will be displayed with bullets                          |

## Shiny writes HTML for you

When you create a UI object in Shiny, Shiny generates HTML. Since Shiny creates websites, and the structure of websites are defined using HTML, this is basically how it has to work! 

You can see the HTML that Shiny has created by just printing the object generated by `fluidPage`. For example, here's how we defined the UI in our Olympics app, and below we can see the HTML.

```{r, eval=FALSE}
library(shiny)

ui <- fluidPage(
  titlePanel("Title"),

  sidebarLayout(
    sidebarPanel(
      
      radioButtons("season",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      ),
      
      selectInput("team",
        "Which Team?",
        choices = c("United States",
                    "Soviet Union",
                    "Germany",
                    "Italy",
                    "Great Britain")
      )
    ),

    mainPanel(
      "Main"
    )
  )
)

ui
```
```
<div class="container-fluid">
  <h2>Title</h2>
  <div class="row">
    <div class="col-sm-4">
      <form class="well">
        <div id="season" class="form-group shiny-input-radiogroup shiny-input-container">
          <label class="control-label" for="season">Summer or Winter Olympics?</label>
          <div class="shiny-options-group">
            <div class="radio">
              <label>
                <input type="radio" name="season" value="Summer" checked="checked"/>
                <span>Summer</span>
              </label>
            </div>
            <div class="radio">
              <label>
                <input type="radio" name="season" value="Winter"/>
                <span>Winter</span>
              </label>
            </div>
          </div>
        </div>
        <div class="form-group shiny-input-container">
          <label class="control-label" for="team">Which Team?</label>
          <div>
            <select id="team"><option value="United States" selected>United States</option>
<option value="Soviet Union">Soviet Union</option>
<option value="Germany">Germany</option>
<option value="Italy">Italy</option>
<option value="Great Britain">Great Britain</option></select>
            <script type="application/json" data-for="team" data-nonempty="">{}</script>
          </div>
        </div>
      </form>
    </div>
    <div class="col-sm-8">Main</div>
  </div>
</div>
```

Don't worry if you don't understand what this HTML is doing. The whole point of Shiny is that you don't need to understand how HTML works to write it.

## Using `tags`

You can't write HTML directly in your Shiny code. R needs to be able to understand which things are R code, which things are HTML and which is just plain text.

There's two options for including HTML in your shiny app. The first is to use the functions found inside `tags`. When you load in `shiny`, you have access to `tags`, which is a big list which contains functions that generate HTML. So to use the `<i>`  and `</i>` tags, you ask for the `i` function from inside `tags`.

```{r}
library(shiny)

tags$i("some text")
```

Some HTML tags need to have attributes. Attributes can be given with named arguments to the function.

```{r}
tags$a("CodeClan's Website", href = "https://codeclan.com/")
```

<blockquote class='task'>
**Task - 2 mins** 

Write some text in bold, using function `b` from inside `tags`.

<details>
<summary>**Answer**</summary>
```{r}
tags$b("Some bold text")
```

</details>
</blockquote>

## Using `HTML`

The second option for including HTML is the function `HTML`. If you need to include a large chunk of HTML, you can include it wrapped within the function `HTML`.

```{r}
HTML(
  "<h2>Here is HTML</h2>

<ul>
  <li>Coffee</li>
  <li>Tea</li>
  <li>Milk</li>
</ul>"
)
```

<blockquote class='task'>
**Task - 5 mins** 

Take your final Olympics Shiny app that we made in the last lesson and:

1. Make the title heading size 1 (use the `<h1>` tag).
2. Make the text "Summer or Winter Olympics?" and "Which Team?", italics.
3. Add a link to the Olympics website (https://www.Olympic.org/) underneath the plot.

<details>
<summary>**Answer**</summary>

```{r}
library(shiny)
library(dplyr)
library(ggplot2)
library(CodeClanData)

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  titlePanel(tags$h1("Olympic Medals")),

    sidebarLayout(
      sidebarPanel(
        
        radioButtons("season",
          tags$i("Summer or Winter Olympics?"),
          choices = c("Summer", "Winter")
        ),
        
        selectInput("team",
          tags$i("Which Team?"),
          choices = all_teams
        )
    ),

    mainPanel(
      plotOutput("medal_plot"),
      tags$a("The Olympics website", href = "https://www.Olympic.org/")
    )
  )
)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    
    olympics_overall_medals %>%
      filter(team == input$team) %>%
      filter(season == input$season) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```
</details>
</blockquote>

# Themes

## `shinythemes`

You can change the look of your app by using any one of the themes available in the `shinythemes` package. 

You can see all the themes available here: https://shiny.rstudio.com/gallery/shiny-theme-selector.html

Inside the`fluidPage` function, give the `theme` argument a value, `shinytheme("<name-of-theme>")`. For example, here's out Olympics app using the "flatly" theme.

```{r}
library(shiny)
library(dplyr)
library(ggplot2)
library(shinythemes)
library(CodeClanData)

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  theme = shinytheme("flatly"),
  
  titlePanel("Olympic Medals"),

  sidebarLayout(
    sidebarPanel(
      radioButtons("season",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      ),

      selectInput("team",
        "Which Team?",
        choices = all_teams,
        selected = "Great Britain"
      )
    ),

    mainPanel(
      plotOutput("medal_plot")
    )
  )
)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team) %>%
      filter(season == input$season) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```


## Write your own theme

You can write your own themes for Shiny apps by writing your own CSS file for the app. To do this you need to add a CSS file into a directory called www inside your app. The www directory is a special directory that Shiny uses when the app is running.

To use the theme just give the name of your CSS file to the theme argument. Now instead of this:

```{r, eval = FALSE}
theme = shinytheme("flatly")
```

do

```{r}
theme = "my_theme.css"
```


# Other Layouts

So far we've only been using the sidebar layout. However, there are a range of other layouts available in Shiny. These are particularly useful for creating more complex layouts, with multiple outputs and many widgets.

In this lesson we are just going to discuss the grid layout, and adding tabs to a layout. More layouts can be seen on the Shiny website: 

## Grid layout

One of the most useful layouts is the grid layout. This lets you build up your page as a series of rows and columns. 

You start this layout with `fluidPage`, just like you did with the sidebar layout. However, instead of using `sidebarLayout`, `sidebarPanel` and `mainPanel` you create your layout using a mixture of 

* `fluidRow`

and

*`column`

The column function has to be inside a `fluidRow`. You specify the size of a column by giving it a number between 1 and 12. The size of all the columns in a row must add up to 12.

Here's our Olympics app, with the widgets at the bottom of the app contained in a column. 

```{r}
library(shiny)
library(dplyr)
library(ggplot2)
library(shinythemes)
library(CodeClanData)

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  plotOutput("medal_plot"),
  
  fluidRow(
    
    column(6, 
    
      radioButtons("season",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      )
           
    ),
    
    column(6,
    
      selectInput("team",
        "Which Team?",
        choices = all_teams,
        selected = "Great Britain"
      )   
           
    )
  )

)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team) %>%
      filter(season == input$season) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```

Note that since the plot is the only thing in it's row, then we don't need to include any `fluidRow` or `columns`. 

<blockquote class='task'>
**Task - 5 mins** 

1. Add a third column which only has a link the the Olympics website.

2. Try out different sizes for the columns

<details>
<summary>**Answer**</summary>

```{r, eval = FALSE}
ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  plotOutput("medal_plot"),
  
  fluidRow(
    
    column(4, 
    
      radioButtons("season",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      )
           
    ),
    
    column(4,
    
      selectInput("team",
        "Which Team?",
        choices = all_teams,
        selected = "Great Britain"
      )   
           
    ),
    
    column(4,
    
      tags$a("The Olympics website",
             href = "https://www.Olympic.org/")
           
    )
  )

)
```

</details>

</blockquote>

## Adding tabs

Tabs aren't strictly a new layout, they can be added into any layout. You use the function `tabsetPanel` with different `tabPanel` elements inside it. 

The first argument to `tabPanel` is the name at the top of the tab, and the second argument is the UI elements you are adding to the tab.

```{r, eval = FALSE}
tabsetPanel(
      tabPanel("First Tab",
               
        "First Tab Content"
        
      ), 
      
      tabPanel("Second Tab",
      
        "Second Tab Content"
      
      ), 
      
      tabPanel("Third Tab",
        
        "Third Tab Content"
      
      )
      
)
```

Here's an example with our Olympics app with the tabs.

```{r}
library(shiny)
library(dplyr)
library(ggplot2)
library(shinythemes)
library(CodeClanData)

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  
  tabsetPanel(
        tabPanel("Plot",
                 
          plotOutput("medal_plot")
          
        ), 
        
        tabPanel("Which season",
        
          radioButtons("season",
            "Summer or Winter Olympics?",
            choices = c("Summer", "Winter")
          )
        
        ), 
        
        tabPanel("Which team?",
          
          selectInput("team",
            "Which Team?",
            choices = all_teams,
            selected = "Great Britain"
          )
        
        )
  )
)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team) %>%
      filter(season == input$season) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```

<blockquote class='task'>
**Task - 5 mins** 

Add another tab which only contains a link to the Olympics website.

<details>
<summary>**Answer**</summary>

```{r}
ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  
  tabsetPanel(
        tabPanel("Plot",
                 
          plotOutput("medal_plot")
          
        ), 
        
        tabPanel("Which season",
        
          radioButtons("season",
            "Summer or Winter Olympics?",
            choices = c("Summer", "Winter")
          )
        
        ), 
        
        tabPanel("Which team?",
          
          selectInput("team",
            "Which Team?",
            choices = all_teams,
            selected = "Great Britain"
          )
        
        ),
        
        tabPanel("Link to Olympics site",
          
          tags$a("The Olympics website",
             href = "https://www.olympic.org/")
        
        )
  )
)
```

</details>
</blockquote>

<hr>

# Recap

* What are the two ways you can include HTML in a Shiny app?
<details>
<summary>**Answer**</summary>
Using functions from `tags` or using `HTML`
</details>

* What are the two ways you can change the theme of a Shiny app?
<details>
<summary>**Answer**</summary>
Using the `shinythemes` package, or by writing your own CSS
</details>

* Which functions do you use to make a grid layout?
<details>
<summary>**Answer**</summary>
`fluidPage`, `fluidRow` and `column`
</details>

* What number should the size of all the columns in a row add up to?
<details>
<summary>**Answer**</summary>
12
</details>

* What functions do you use to add tabs?
<details>
<summary>**Answer**</summary>
`tabsetPanel` and `tabPanel`
</details>

<hr>

# Additional Resources

* More on HTML in shiny: https://shiny.rstudio.com/articles/html-tags.html

* More on adding CSS: https://shiny.rstudio.com/articles/css.html

* More on layouts: https://shiny.rstudio.com/articles/layout-guide.html


